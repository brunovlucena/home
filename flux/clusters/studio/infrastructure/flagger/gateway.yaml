apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: flagger-gateway
  namespace: flagger-system
spec:
  # 🚦 Gateway Configuration for Blue/Green Deployments
  # 🎯 Traffic Management and Load Balancing
  
  # 🔧 Selector for Istio Ingress Gateway
  selector:
    istio: ingressgateway
  
  # 🌐 Server Configuration
  servers:
  # 🔵 HTTP Traffic (Port 80)
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - "bruno.dev.local"
    - "*.bruno.dev.local"
    - "flagger.bruno.dev.local"
    tls:
      httpsRedirect: true
  
  # 🟢 HTTPS Traffic (Port 443)
  - port:
      number: 443
      name: https
      protocol: HTTPS
    hosts:
    - "bruno.dev.local"
    - "*.bruno.dev.local"
    - "flagger.bruno.dev.local"
    tls:
      mode: SIMPLE
      credentialName: bruno-tls-cert
      # 🔐 TLS Configuration
      # 📝 Note: Requires cert-manager certificate
      # 🎯 Auto-generated certificate for *.bruno.dev.local
  
  # 🔍 Health Check Endpoint
  - port:
      number: 8080
      name: health
      protocol: HTTP
    hosts:
    - "health.bruno.dev.local"
    tls:
      httpsRedirect: false
