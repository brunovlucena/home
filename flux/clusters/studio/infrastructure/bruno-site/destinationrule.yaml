# apiVersion: networking.istio.io/v1beta1
# kind: DestinationRule
# metadata:
#   name: bruno-site
#   namespace: bruno
# spec:
#   # ğŸ¯ Destination Rule for Blue/Green Deployments
#   # ğŸ”„ Traffic Splitting and Load Balancing
  
#   # ğŸŒ Host Configuration
#   host: bruno-site.bruno.svc.cluster.local
  
#   # ğŸ”„ Traffic Policy
#   trafficPolicy:
#     # ğŸ” TLS Configuration
#     tls:
#       mode: ISTIO_MUTUAL
#       sni: bruno-site.bruno.svc.cluster.local
    
#     # ğŸ”„ Connection Pool Configuration
#     connectionPool:
#       http:
#         http1MaxPendingRequests: 1024
#         maxRequestsPerConnection: 10
#         maxRetries: 3
#         idleTimeout: 1h
#       tcp:
#         maxConnections: 100
#         connectTimeout: 30s
#         tcpKeepalive:
#           time: 7200s
#           interval: 75s
#           probes: 9
    
#     # ğŸ”„ Outlier Detection
#     outlierDetection:
#       consecutive5xxErrors: 5
#       interval: 30s
#       baseEjectionTime: 30s
#       maxEjectionPercent: 10
#       minHealthPercent: 50
  
#   # ğŸ¨ Subsets for Blue/Green Traffic
#   subsets:
#   # ğŸ”µ Blue Environment (Current Production)
#   - name: blue
#     labels:
#       version: blue
#       environment: production
#     trafficPolicy:
#       loadBalancer:
#         simple: ROUND_ROBIN
#       connectionPool:
#         http:
#           maxRequestsPerConnection: 10
#           maxRetries: 3
#       outlierDetection:
#         consecutive5xxErrors: 3
#         interval: 30s
#         baseEjectionTime: 30s
  
#   # ğŸŸ¢ Green Environment (New Deployment)
#   - name: green
#     labels:
#       version: green
#       environment: staging
#     trafficPolicy:
#       loadBalancer:
#         simple: ROUND_ROBIN
#       connectionPool:
#         http:
#           maxRequestsPerConnection: 10
#           maxRetries: 3
#       outlierDetection:
#         consecutive5xxErrors: 2
#         interval: 15s
#         baseEjectionTime: 15s
  
#   # ğŸ”„ Canary Environment (Testing)
#   - name: canary
#     labels:
#       version: canary
#       environment: testing
#     trafficPolicy:
#       loadBalancer:
#         simple: LEAST_CONN
#       connectionPool:
#         http:
#           maxRequestsPerConnection: 5
#           maxRetries: 1
#       outlierDetection:
#         consecutive5xxErrors: 1
#         interval: 10s
#         baseEjectionTime: 10s
