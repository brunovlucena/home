# apiVersion: flagger.app/v1beta1
# kind: Canary
# metadata:
#   name: bruno-site
#   namespace: bruno
# spec:
#   # ğŸ¯ Target Configuration
#   targetRef:
#     apiVersion: apps/v1
#     kind: Deployment
#     name: bruno-site
  
#   # ğŸ”„ Progress Tracking
#   progressDeadlineSeconds: 600
  
#   # ğŸ“Š Analysis Configuration
#   analysis:
#     # â±ï¸ Analysis Interval
#     interval: 30s
    
#     # ğŸ“ˆ Threshold for Success
#     threshold: 10
    
#     # ğŸ”„ Max Failures Before Rollback
#     maxFailures: 3
    
#     # ğŸ“Š Metrics for Analysis
#     metrics:
#     - name: request-success-rate
#       thresholdRange:
#         min: 99
#       interval: 1m
#     - name: request-duration
#       thresholdRange:
#         max: 500
#       interval: 1m
#     - name: error-rate
#       thresholdRange:
#         max: 1
#       interval: 1m
    
#     # ğŸ” Webhook for Custom Analysis
#     webhooks:
#     - name: load-test
#       url: http://k6-operator.k6-operator.svc:8080/load-test
#       timeout: 5s
#       metadata:
#         type: cmd
#         cmd: "k6 run --out influxdb=http://prometheus-operated.prometheus.svc:9090 /scripts/load-test.js"
  
#   # ğŸš¦ Traffic Management
#   service:
#     port: 8080
#     targetPort: 8080
#     portDiscovery: true
  
#   # ğŸ”„ Blue/Green Strategy
#   strategy: BlueGreen
  
#   # ğŸ¨ Blue/Green Configuration
#   blueGreen:
#     # ğŸ”µ Blue Environment (Current)
#     blue:
#       replicas: 2
#       resources:
#         requests:
#           cpu: 100m
#           memory: 128Mi
#         limits:
#           cpu: 200m
#           memory: 256Mi
    
#     # ğŸŸ¢ Green Environment (New)
#     green:
#       replicas: 2
#       resources:
#         requests:
#           cpu: 100m
#           memory: 128Mi
#         limits:
#           cpu: 200m
#           memory: 256Mi
    
#     # ğŸ”„ Traffic Switching
#     trafficRouting:
#       istio:
#         virtualService:
#           name: bruno-site-vs
#           routes:
#           - name: primary
#             weight: 100
#           - name: canary
#             weight: 0
    
#     # â±ï¸ Promotion Configuration
#     promotion:
#       # ğŸ”„ Auto Promotion
#       autoPromotionEnabled: false
      
#       # â±ï¸ Promotion Timeout
#       promotionTimeout: 300s
      
#       # ğŸ”„ Rollback on Failure
#       rollbackOnFailure: true
      
#       # ğŸ“Š Promotion Criteria
#       analysis:
#         interval: 30s
#         threshold: 5
#         maxFailures: 2
#         metrics:
#         - name: request-success-rate
#           thresholdRange:
#             min: 99
#           interval: 1m
#         - name: request-duration
#           thresholdRange:
#             max: 500
#           interval: 1m
    
#     # ğŸ§¹ Cleanup Configuration
#     cleanup:
#       # ğŸ—‘ï¸ Auto Cleanup Old Revisions
#       autoCleanup: true
      
#       # â±ï¸ Cleanup Delay
#       cleanupDelay: 300s
      
#       # ğŸ“Š Cleanup Criteria
#       analysis:
#         interval: 30s
#         threshold: 3
#         maxFailures: 1
#         metrics:
#         - name: request-success-rate
#           thresholdRange:
#             min: 95
#           interval: 1m
