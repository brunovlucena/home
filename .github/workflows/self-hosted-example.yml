name: ðŸƒâ€â™‚ï¸ Self-Hosted Runner Example

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

env:
  # Use self-hosted runners to keep data private
  RUNNER_LABELS: "self-hosted,linux,x64,home-infrastructure"

jobs:
  # Example job using self-hosted runners
  build-and-test:
    name: ðŸ—ï¸ Build and Test
    runs-on: [self-hosted, linux, x64, home-infrastructure]
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: ðŸ³ Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: ðŸ” Show runner information
        run: |
          echo "ðŸƒâ€â™‚ï¸ Running on self-hosted runner"
          echo "ðŸ“ Runner OS: $(uname -a)"
          echo "ðŸ’¾ Available disk space:"
          df -h
          echo "ðŸ§  Available memory:"
          free -h
          echo "ðŸ”§ Docker version:"
          docker --version
          echo "ðŸ Python version:"
          python3 --version || echo "Python not available"
          echo "ðŸ¦€ Rust version:"
          rustc --version || echo "Rust not available"
          echo "ðŸŸ¢ Go version:"
          go version || echo "Go not available"
          echo "ðŸ“¦ Node.js version:"
          node --version || echo "Node.js not available"
      
      - name: ðŸ—ï¸ Build infrastructure
        run: |
          echo "ðŸ—ï¸ Building infrastructure components..."
          # Example build commands
          echo "âœ… Infrastructure build completed"
      
      - name: ðŸ§ª Run tests
        run: |
          echo "ðŸ§ª Running tests..."
          # Example test commands
          echo "âœ… All tests passed"
      
      - name: ðŸ“Š Generate build report
        run: |
          echo "ðŸ“Š Generating build report..."
          cat > build-report.md << EOF
          # Build Report
          
          **Date**: $(date)
          **Runner**: Self-hosted (Home Infrastructure)
          **OS**: $(uname -s)
          **Architecture**: $(uname -m)
          
          ## Build Status
          - âœ… Infrastructure build: Success
          - âœ… Tests: Passed
          - âœ… Security scan: Clean
          
          ## Resource Usage
          - **CPU**: $(grep 'cpu ' /proc/stat | awk '{usage=($2+$4)*100/($2+$3+$4)} END {print usage "%"}')
          - **Memory**: $(free | grep Mem | awk '{printf "%.1f%%", $3/$2 * 100.0}')
          - **Disk**: $(df -h / | awk 'NR==2{printf "%s", $5}')
          
          ## Privacy Notice
          ðŸ›¡ï¸ This build was executed on a self-hosted runner in your home infrastructure.
          Your code and build artifacts remain private and are not used for training purposes.
          EOF
          
          echo "ðŸ“„ Build report generated"
          cat build-report.md
      
      - name: ðŸ“¤ Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: build-report
          path: build-report.md
          retention-days: 30

  # Example job for container builds
  container-build:
    name: ðŸ³ Container Build
    runs-on: [self-hosted, linux, x64, home-infrastructure]
    needs: build-and-test
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      - name: ðŸ³ Build container image
        run: |
          echo "ðŸ³ Building container image..."
          # Example container build
          docker build -t home-infrastructure:latest .
          echo "âœ… Container build completed"
      
      - name: ðŸ·ï¸ Tag container image
        run: |
          echo "ðŸ·ï¸ Tagging container image..."
          docker tag home-infrastructure:latest home-infrastructure:$(date +%Y%m%d-%H%M%S)
          docker tag home-infrastructure:latest home-infrastructure:latest
          echo "âœ… Container image tagged"
      
      - name: ðŸ“Š Show container information
        run: |
          echo "ðŸ“Š Container information:"
          docker images home-infrastructure
          docker inspect home-infrastructure:latest | jq '.[0].Config.Labels' || echo "No labels found"

  # Example job for security scanning
  security-scan:
    name: ðŸ”’ Security Scan
    runs-on: [self-hosted, linux, x64, home-infrastructure]
    needs: build-and-test
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      - name: ðŸ”’ Run security scan
        run: |
          echo "ðŸ”’ Running security scan..."
          # Example security scan commands
          echo "ðŸ” Scanning for vulnerabilities..."
          echo "âœ… Security scan completed - No issues found"
      
      - name: ðŸ“Š Generate security report
        run: |
          cat > security-report.md << EOF
          # Security Scan Report
          
          **Date**: $(date)
          **Scanner**: Self-hosted security tools
          **Status**: âœ… Clean
          
          ## Scan Results
          - âœ… No critical vulnerabilities found
          - âœ… No high-severity issues detected
          - âœ… Dependencies are up to date
          - âœ… No secrets detected in code
          
          ## Privacy Notice
          ðŸ›¡ï¸ This security scan was performed on your self-hosted infrastructure.
          All scan data remains private and is not shared with external services.
          EOF
          
          echo "ðŸ“„ Security report generated"
          cat security-report.md
      
      - name: ðŸ“¤ Upload security report
        uses: actions/upload-artifact@v4
        with:
          name: security-report
          path: security-report.md
          retention-days: 90

  # Example job for deployment
  deploy:
    name: ðŸš€ Deploy
    runs-on: [self-hosted, linux, x64, home-infrastructure]
    needs: [build-and-test, container-build, security-scan]
    if: github.ref == 'refs/heads/main'
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      - name: ðŸš€ Deploy to home infrastructure
        run: |
          echo "ðŸš€ Deploying to home infrastructure..."
          # Example deployment commands
          echo "ðŸ“¦ Deploying infrastructure components..."
          echo "ðŸ”„ Updating services..."
          echo "âœ… Deployment completed successfully"
      
      - name: ðŸ” Verify deployment
        run: |
          echo "ðŸ” Verifying deployment..."
          # Example verification commands
          echo "âœ… Deployment verification completed"
      
      - name: ðŸ“Š Generate deployment report
        run: |
          cat > deployment-report.md << EOF
          # Deployment Report
          
          **Date**: $(date)
          **Environment**: Home Infrastructure
          **Status**: âœ… Success
          
          ## Deployment Summary
          - âœ… Infrastructure components deployed
          - âœ… Services updated successfully
          - âœ… Health checks passed
          - âœ… Monitoring configured
          
          ## Privacy Notice
          ðŸ›¡ï¸ This deployment was executed on your self-hosted infrastructure.
          All deployment data and logs remain private and secure.
          EOF
          
          echo "ðŸ“„ Deployment report generated"
          cat deployment-report.md
      
      - name: ðŸ“¤ Upload deployment report
        uses: actions/upload-artifact@v4
        with:
          name: deployment-report
          path: deployment-report.md
          retention-days: 30

  # Example job for cleanup
  cleanup:
    name: ðŸ§¹ Cleanup
    runs-on: [self-hosted, linux, x64, home-infrastructure]
    needs: [build-and-test, container-build, security-scan, deploy]
    if: always()
    
    steps:
      - name: ðŸ§¹ Cleanup resources
        run: |
          echo "ðŸ§¹ Cleaning up resources..."
          # Example cleanup commands
          echo "ðŸ—‘ï¸ Removing temporary files..."
          echo "ðŸ’¾ Cleaning up Docker images..."
          echo "âœ… Cleanup completed"
      
      - name: ðŸ“Š Generate cleanup report
        run: |
          cat > cleanup-report.md << EOF
          # Cleanup Report
          
          **Date**: $(date)
          **Status**: âœ… Completed
          
          ## Cleanup Summary
          - âœ… Temporary files removed
          - âœ… Docker images cleaned up
          - âœ… Build artifacts archived
          - âœ… Logs rotated
          
          ## Privacy Notice
          ðŸ›¡ï¸ All cleanup operations were performed on your self-hosted infrastructure.
          No data was transmitted to external services.
          EOF
          
          echo "ðŸ“„ Cleanup report generated"
          cat cleanup-report.md
      
      - name: ðŸ“¤ Upload cleanup report
        uses: actions/upload-artifact@v4
        with:
          name: cleanup-report
          path: cleanup-report.md
          retention-days: 7
